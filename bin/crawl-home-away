#!/usr/bin/env php
<?php

use FlatFindr\HomeAway\CrawlerListingSearch;

require_once __DIR__ . '/../vendor/autoload.php';
require_once __DIR__ . '/../library/simple_html_dom.php';
require_once __DIR__ . '/../config/bootstrap.php';

$orm = LoadServiceEntityManager();

$crawler = new CrawlerListingSearch();
if(APP_ENVIRONMENT=='development') {
    $crawler->setCacheEnabled(true)
        ->setCacheDirectory(APP_PATH . '/data/cache/');
}

// Go thru all flats in da search
$listingUrls = $crawler->requestSearch();
foreach($listingUrls as $listing) {
    var_dump($listing);
    $listing = $crawler->requestDetailsByUrl($listing->getUrlDetail(), $listing);
    var_dump($listing);
}

